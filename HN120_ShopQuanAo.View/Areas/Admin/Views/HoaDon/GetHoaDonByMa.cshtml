@using HN120_ShopQuanAo.Data.Configurations
@using HN120_ShopQuanAo.Data.Models
@using HN120_ShopQuanAo.View.Areas.Admin.Data
@model HN120_ShopQuanAo.Data.Models.HoaDon

@{
    ViewData["Title"] = "GetHoaDonByMa";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    IEnumerable<User> ListUseradmin = ViewBag.ListUseradmin as IEnumerable<User>;
    IEnumerable<Voucher> lstVC = ViewBag.lstVC as IEnumerable<Voucher>;
    IEnumerable<User> Listaccout = ViewBag.Listaccout as IEnumerable<User>;
    IEnumerable<ThanhToan> lstt = ViewBag.lstt as IEnumerable<ThanhToan>;
    IEnumerable<HoaDonChiTiet> lsthdct = ViewBag.lsthdct as IEnumerable<HoaDonChiTiet>;
    IEnumerable<ChiTietSPView> litspctview = ViewBag.JoinedData as IEnumerable<ChiTietSPView>;
    IEnumerable<ThanhToan_HoaDon> lstThanhToan_hd = ViewBag.lstThanhToan_hd as IEnumerable<ThanhToan_HoaDon>;
    IEnumerable<HoaDon_History> ListLSHD = ViewBag.ListLSHD as IEnumerable<HoaDon_History>;
    var user = ViewBag.Model;
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" integrity="sha512-b2QcS5SsA8tZodcDtGRELiGv5SaKSk1vDHDaQRda0htPYWZ6046lr3kJ5bAAQdpV2mmA/4v0wQF9MyU6/pDIAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        font-family: 'Arial', sans-serif;
        background-color: #f8f9fa;
        padding: 20px;
    }

    .table-container {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .table-fixed thead th {
        position: sticky;
        top: 0;
        background-color: #343a40;
        color: white;
    }

    .table-fixed td, .table-fixed th {
       /*  padding: 10px; */
        border-bottom: 1px solid #dee2e6;
    }

    .btn {
        border-radius: 50px;
        transition: background-color 0.3s;
    }

    .btn-primary {
        background-color: #007bff;
        border: none;
    }

        .btn-primary:hover {
            background-color: #0056b3;
        }

    .btn-danger {
        background-color: #dc3545;
        border: none;
    }

        .btn-danger:hover {
            background-color: #c82333;
        }

    .table {
        margin-bottom: 20px;
    }

    .table-bordered th, .table-bordered td {
        border: 1px solid #dee2e6;
    }

    .table-bordered thead th {
        background-color: #343a40;
        color: white;
    }

    .table-bordered tbody td {
        vertical-align: middle;
    }
   
    .table-container hr {
        margin: 20px 0;
    }

    .table img {
        max-width: 100%;
        border-radius: 5px;
    }

    h4 {
        margin-top: 20px;
        margin-bottom: 10px;
        color: #343a40;
    }

    .content {
        margin-bottom: 20px;
    }

        .content hr {
            margin: 20px 0;
        }
</style>
<!-- Thêm jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Thêm Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.min.js" integrity="sha512-WW8/jxkELe2CAiE4LvQfwm1rajOS8PHasCCx+knHG0gBHt8EXxS6T6tJRTGuDQVnluuAvMxWF4j8SNFDKceLFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src="~/src/assets/libs/jquery/dist/jquery.min.js"></script>
<script src="~/js/notify.js"></script>
<script src="~/js/Hoadon/GetDiaChi.js"></script>
<script src="~/js/Hoadon/CRUDHoaDon.js"></script>
<script src="~/js/Hoadon/CapNhatChiTietHoaDon.js"></script>

<div class="container mt-4">
<div class="row">
    <div class="col-md-12">
        <div class="table-container" style="overflow-x: auto; height: 200px; overflow-y: hidden;">
            <table class="table-fixed" style="white-space: nowrap; margin: 0 auto;">
                <thead>
                    
                </thead>
                <tbody>
                    <tr>
                        @foreach (var item in ListLSHD)
                        {
                            <td style="width: 200px; vertical-align: top; white-space: normal; text-align: center;">
                                @if (item.TrangThai == 1)
                                {
                                    <img src="~/Quanlydonhang/1.png" style="width: 100%; height: auto;" />
                                    <br />
                                    <p style="text-align:center">Chờ xác nhận</p>
                                    <span style="word-wrap: break-word;">@item.NgayTaoDon</span>
                                }
                                @if (item.TrangThai == 2)
                                {
                                    <img src="~/Quanlydonhang/2.png" style="width: 100%; height: auto;" />
                                    <br />
                                    <p style="text-align:center">Đã xác nhận</p>
                                    <span style="word-wrap: break-word;">@item.NgayTaoDon</span>
                                }
                                @if (item.TrangThai == 3)
                                {
                                    <img src="~/Quanlydonhang/3.png" style="width: 100%; height: auto;" />
                                    <br />
                                    <p style="text-align:center">Chờ giao hàng</p>
                                    <span style="word-wrap: break-word;">@item.NgayTaoDon</span>
                                }
                                @if (item.TrangThai == 4)
                                {
                                    <img src="~/Quanlydonhang/4.png" style="width: 100%; height: auto;" />
                                    <br />
                                    <p style="text-align:center">Đang giao hàng</p>
                                    <span style="word-wrap: break-word;">@item.NgayTaoDon</span>
                                }
                                @if (item.TrangThai == 5)
                                {
                                    <img src="~/Quanlydonhang/5.png" style="width: 100%; height: auto;" />
                                    <br />
                                    <p style="text-align:center">Đã hoàn thành</p>
                                    <span style="word-wrap: break-word;">@item.NgayTaoDon</span>
                                }
                                @if (item.TrangThai == 6)
                                {
                                    <img src="~/Quanlydonhang/6.png" style="width: 100%; height: auto;" />
                                    <br />
                                    <p style="text-align:center">Hủy</p>
                                    <span style="word-wrap: break-word;">@item.NgayTaoDon</span>
                                }
                                    @if (item.TrangThai == 7)
                                    {
                                        <img src="~/Quanlydonhang/7.png" style="width: 100%; height: auto;" />
                                        <br />
                                        <p style="text-align:center">@user.UserName đã chỉnh sửa</p>
                                        <span style="word-wrap: break-word;">@item.NgayTaoDon</span>
                                    }
                            </td>
                        }
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
   <hr />
        @if (Model.TrangThai == 1 && Model.PhanLoai == "2")
        {
            <div class="col-md-2">
                <button class="btn btn-primary" id="btn_Xacnhandonhang">Xác nhận</button>
            </div>
        }
        @if (Model.TrangThai == 2)
        {
            <div class="col-md-4">
                <button class="btn btn-primary" id="btn_ChoGiaoHang">Chờ giao hàng</button>
            </div>
        }
        @if (Model.TrangThai == 3)
        {
            <div class="col-md-2">
                <button class="btn btn-primary" id="btn_GiaoHang">Đang giao</button>
            </div>
        }
        @if (Model.TrangThai == 4)
        {
            <div class="col-md-2">
                <button class="btn btn-primary" id="btn_HoanThanh"> Hoàn thành</button>
            </div>
        }
        @* @if (Model.TrangThai == 5)
        {          
            <div class="col-md-2">
                <button class="btn btn-primary" id="btn_XacnhanThanh">Xác nhận hoàn thành</button>
            </div>
        } *@
        @if (Model.TrangThai == 1 || Model.TrangThai == 2 || Model.TrangThai == 3)
        {
            <div class="col-md-2">
                <button class="btn btn-danger" id="btn_huydon"> Hủy đơn</button>
            </div>
        }
        @if (Model.PhanLoai == "1")
        {
            @if (Model.TrangThai == 3)
            {
                <div class="col-md-2">
                    <button class="btn btn-danger" id="btn_back"> Quay lại</button>
                </div>

            }
        }
        @if (Model.PhanLoai == "2")
        {
            @if (Model.TrangThai >= 2 && Model.TrangThai <= 3)
            {
                <div class="col-md-2">
                    <button class="btn btn-danger" id="btn_back"> Quay lại</button>
                </div>

            }
        }
        
    
</div>

<hr />


<div>
    <div class="row">
        <div class="col-md-4">
            <h4>@Model.MaHoaDon</h4>
        </div>
        <div class="col-md-8 d-flex justify-content-end align-items-center">
            <button class="btn btn-danger" id="btn_xemlichsu" style="margin-right: 20px;">Lịch sử</button>
        </div>
    </div>
    <input style="display:none" id="btn_mahoadon" value="@Model.MaHoaDon" />
    <hr />
    <table class="table table-bordered" id="table_hoadon">

    <thead>
        <tr>
                <th style="text-align : center;">
                    Mã hóa đơn
                </th>

                <th style="text-align : center;">
                    Người tạo
                </th>
                <th style="text-align : center;">
                    Mã Voucher
                </th>
                <th style="text-align : center;">
                    Ngày tạo
                </th>
                <th style="text-align : center;">
                    Tên khách hàng
                </th>
                <th style="text-align : center;">
                    Số điện thoại
                </th>
                <th style="text-align : center;">
                    Phí ship
                </th>
                <th style="text-align : center;">
                    Tổng giá trị
                </th>
                <th style="text-align : center;">
                    Phương thức thanh toán
                </th>
                <th style="text-align : center;">
                    Trạng thái
                </th>
                @if (Model.TrangThai == 1 || Model.TrangThai == 2 || Model.TrangThai == 3)
                {
                    <th>Hành động</th>
                }
                
        </tr>
    </thead>
        <tbody>
            <tr>

                <td style="text-align : center; margin-bottom : 20px">
                    @Model.MaHoaDon
                </td>
                <td style="text-align : center; margin-bottom : 20px">
                    @foreach (var nv in ListUseradmin)
                    {
                        if (nv.Id == Model.UserID)
                        {
                            @nv.FullName
                            ;
                        }
                    }
                </td>
                <td style="text-align : center; margin-bottom : 20px">
                    @foreach (var vc in lstVC)
                    {
                        if (vc.MaVoucher == Model.MaVoucher)
                        {
                            @vc.Ten
                            ;
                        }
                    }
                </td>
                <td style="text-align : center; margin-bottom : 20px">
                    @Model.NgayTaoDon
                </td>
                <td style="text-align : center; margin-bottom : 20px">
                     @Model.TenKhachHang                      
                </td>
                    <td style="text-align : center; margin-bottom : 20px" >
                    @Model.SoDienThoai
                </td>
                    <td style="text-align : center; margin-bottom : 20px" class="money">
                    @Model.PhiShip
                </td>
                    <td style="text-align : center; margin-bottom : 20px" class="money">
                    @Model.TongGiaTriHangHoa
                </td>
                <td style="text-align : center; margin-bottom : 20px">
                    @if (Model.PhuongThucThanhToan == 1)
                    {
                        <p>Tiền mặt</p>
                    }
                    @if (Model.PhuongThucThanhToan == 2)
                    {
                        <p>Chuyển khoản</p>

                    }
                    @if (Model.PhuongThucThanhToan == 3)
                    {
                        <p>Thập cẩm</p>
                    }
                    @if (Model.PhuongThucThanhToan == 4)
                    {
                        <p>Thanh toán khi nhận hàng</p>
                    }
                </td>

                @if (Model.TrangThai == 1)
                {
                    <td style="text-align : center; margin-bottom : 20px">
                        Chờ xác nhận
                    </td>
                }
                @if (Model.TrangThai == 2)
                {
                    <td style="text-align : center; margin-bottom : 20px">
                        Đã xác nhận
                    </td>
                }
                @if (Model.TrangThai == 3)
                {
                    <td style="text-align : center; margin-bottom : 20px">
                        Chờ giao hàng
                    </td>
                }
                @if (Model.TrangThai == 4)
                {
                    <td style="text-align : center; margin-bottom : 20px">
                        Đang giao
                    </td>
                }
                @if (Model.TrangThai == 5)
                {
                    <td style="text-align : center; margin-bottom : 20px">
                        Hoàn thành
                    </td>
                }
                @if (Model.TrangThai == 6)
                {
                    <td style="text-align : center; margin-bottom : 20px">
                        Hủy
                    </td>
                }
                @if (Model.TrangThai <= 3)
                {
                    <td>
                        <button class="btn btn-danger" id="btn_update_hoadon" data-mahoadon="@Model.MaHoaDon" > Cập nhật</button>
                    </td>
                }

                <input type="hidden" id="stt_hoadon" value="@Model.TrangThai" />
            </tr>
        </tbody>

    </table>
    <hr />
</div>

<div>
    <h4>Thanh toán</h4>
    <hr />
    <table class="table table-bordered" id="tb_thanhtoan">

        <thead>
            <tr style="text-align : center; margin-bottom : 20px">
                <th style="text-align : center;">
                    Phương thức thanh toán
                </th>
                <th style="text-align : center;">
                    Ngày tạo
                </th>
                <th style="text-align : center;">
                    Trạng thái
                </th>
                
            </tr>
        </thead>
        <tbody>
            @foreach (var item in lstThanhToan_hd)
            {
                if (item.MaHoaDon == Model.MaHoaDon)
                {
                    var ten = lstt.FirstOrDefault(tt => tt.MaPhuongThuc == item.MaPhuongThuc);
                    <tr style="text-align : center; margin-bottom : 20px">
                        <td style="text-align : center; margin-bottom : 20px;display:none" class="MaHoaDon_">@item.MaHoaDon</td>
                        <td style="text-align : center; margin-bottom : 20px;display:none" class="MaPhuongThuc_">@item.MaPhuongThuc</td>
                        <td style="text-align : center; margin-bottom : 20px;display:none" class="MaPhuongThuc_HoaDon_">@item.MaPhuongThuc_HoaDon</td>
                        <td style="text-align : center; margin-bottom : 20px" class="TenPhuongThuc_">@ten.TenPhuongThuc</td>
                        <td style="text-align : center; margin-bottom : 20px" class="NgayTao_">@item.NgayTao</td>
                        <td style="text-align : center; margin-bottom : 20px;display:none">
                            <input type="text" id="ngayupdate_tthd" />
                        </td>
                        <td style="text-align : center; margin-bottom : 20px" class="tt">
                            @if (@item.TrangThai == 1)
                            {
                                <p>Đã thanh toán</p>
                            }
                            else
                            {
                                <p>Chưa thanh toán</p>
                            }
                        </td>
                      
                    </tr>
                }
            }
        </tbody>
    </table>
    <hr />
</div>
<div style="height: 600px; overflow-y: auto;">
    <h4>Chi tiết hóa đơn</h4>
    @if (Model.TrangThai == 1 || Model.TrangThai == 2 || Model.TrangThai == 3)
    {
        <div>
            <button class="btn btn-primary" id="btn_themchitietsp">Thêm sản phẩm</button>
        </div>
    }
    <hr />
    <table class="table table-bordered" id="hoaDonctTable">
        <thead>
            <tr>
                <th style="text-align : center; margin-bottom : 20px">STT</th>
                <th style="text-align : center; margin-bottom : 20px">Ảnh</th>
                <th style="text-align : center; margin-bottom : 20px">SKU</th>
                <th style="text-align : center; margin-bottom : 20px">Tên  sản phẩm</th>
                <th style="text-align : center; margin-bottom : 20px">Màu sắc</th>
                <th style="text-align : center; margin-bottom : 20px">Size</th>
                <th style="text-align : center; margin-bottom : 20px">Số lượng mua </th>
                <th style="text-align : center; margin-bottom : 20px">Đơn giá </th>
                 @if (Model.TrangThai == 1 || Model.TrangThai == 2 || Model.TrangThai == 3)
                {
                    <th style="text-align : center; margin-bottom : 20px">Hành động </th>
                }

            </tr>
        </thead>
        <tbody>
            
            @{
                int i = 1;

            }
            @foreach (var item in lsthdct)
            { 
                if (item.MaHoaDon == Model.MaHoaDon)
                {
                    var chiTietSPView = litspctview.FirstOrDefault(sp => sp.SKU == item.SKU);
                    <tr>
                        <td style="text-align : center; margin-bottom : 20px">@i</td>
                        <td style="text-align : center; margin-bottom : 20px">  
                            <img src="~/photoSanPhamCT/@chiTietSPView.UrlAnhSpct" alt="Combo Image" width="100" height="100" />
                            </td>
                            <td style="text-align : center; margin-bottom : 20px" class="sku">@chiTietSPView?.SKU</td>
                        <td style="text-align : center; margin-bottom : 20px">@chiTietSPView?.TenSP</td>
                        <td style="text-align : center; margin-bottom : 20px">@chiTietSPView?.TenMau</td>
                        <td style="text-align : center; margin-bottom : 20px">@chiTietSPView?.TenSize</td>
                        <td style="text-align : center; margin-bottom : 20px">@item.SoLuongMua</td>
                        <td style="text-align : center; margin-bottom : 20px" class="money">@item.DonGia</td>
                        
                        @if (Model.TrangThai == 1 || Model.TrangThai == 2 || Model.TrangThai == 3)
                        {
                            <td style="text-align : center; margin-bottom : 20px">
                                <button class="btn btn-outline-dange" id="btn_xoachitietsp" data-ma="@item.MaHoaDonChiTiet"><i class="fa-solid fa-trash" style="color: #f31212;"></i></button>
                            </td>
                        }
                            <td type="hidden">
                            <input  type="hidden" class="maHoaDonChiTiet" value="@item.MaHoaDonChiTiet" />
                            <input  type="hidden" class="sku" value="@item.SKU"/>
                            <input  type="hidden" id="btn_nhap"/>
                            <input  type="hidden" class="maHoaDon" value="@item.MaHoaDon"/>
                            <input  type="hidden" class="tenSp" value="@item.TenSp"/>
                            <input  type="hidden" class="soLuongMua" value="@item.SoLuongMua"/>
                            <input  type="hidden" class="donGia" value="@item.DonGia"/>
                            <input  type="hidden" class="trangThai" value="@item.TrangThai"/>
                            <input  type="hidden" class="masp" value="@chiTietSPView.MaSp"/>
                            <input  type="hidden" class="masz" value="@chiTietSPView.MaSize"/>
                            <input  type="hidden" class="MaMau" value="@chiTietSPView.MaMau"/>
                            <input  type="hidden" class="MaKhuyenMai" value="@chiTietSPView.MaKhuyenMai" />
                            <input  type="hidden" class="img" value="@chiTietSPView.UrlAnhSpct" />
                            <input  type="hidden" class="DonGia_" value="@chiTietSPView.Dongia" />
                            <input  type="hidden" class="GiaBan" value="@chiTietSPView.GiaBan" />
                            <input  type="hidden" class="SoLuongTon" value="@chiTietSPView.SoLuongTon" />
                            <input  type="hidden" class="tt" value="@chiTietSPView.TrangThai" />
                         </td>
                    </tr>
                 
                i++;
                }
            }
        </tbody>
    </table>
    <hr />
</div>
</div>
@* modal danh sach sản phẩm *@

<div class="modal fade" tabindex="-1" id="pop_sp">
    <div class="modal-dialog  modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Danh sách sản phẩm</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card-body" style="height: 430px; overflow-y: auto;">
                    <partial name="SP_partial" />
                </div>
            </div>
            <div class="modal-footer">
                
            </div>
        </div>
    </div>
</div>
<div class="modal fade" tabindex="-1" id="pop_huydon">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Đơn hàng bị hủy sẽ không thể chỉnh sửa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card-body">
                    <div style="display:none">
                        <label for="btn_mahoadonls">Mã Hóa Đơn</label>                        <input type="type" id="btn_mahoadonls" value="@Model.MaHoaDon" />
                    </div>
                    <div style ="display:none">
                        <label for="btn_nhanvien">Nhân viên</label>
                        @foreach (var nv in ListUseradmin)
                        {
                            if (nv.Id == Model.UserID)
                            {

                                <input type="type" id="btn_nhanvien" value="@nv.FullName" />
                            }
                        }
                    </div>
                    <div style="display:none">
                        <label for="btn_ngaytao">Ngày tạo</label>
                        <input id="btn_ngaytao" type="datetime" />
                    </div>
                    <div style="display:none">
                        <label for="btn_ngaythaydoils">ngày thay dổi</label>
                        <input type="datetime" id="btn_ngaythaydoils" />
                    </div>
                    <div style="display:none">
                        <label for="btn_tonggiatrihd">Tổng giá trị</label>
                        <input class="money" type="text" id="btn_tonggiatrihd" value="@Model.TongGiaTriHangHoa" />
                    </div>
                    <div style="display:none">
                        <label for="btn_httt">Phương thức</label>
                        <input type="type" id="btn_httt" value="@Model.PhuongThucThanhToan" />
                    </div>
                    <div>
                        <label for="btn_ghichuhuy">Ghi chú</label>
                        <textarea class="form-control" id="btn_ghichuhuy" rows="4" placeholder="Nhập ghi chú ..."></textarea>
                    </div>
                    <div style="display:none">
                        <label for="btn_trangthai">Trạng thái</label>
                        <input type="number" id="btn_trangthai" value="6" />
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btn_dongy">Đồng ý</button>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" tabindex="-1" id="pop_soluongmua">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nhập số lượng mua</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card-body">
                    <div>
                        <input type="number" min="1" class="form-control" name="name" id="inp_soluongmua" />
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btn_themsoluong">Thêm</button>
            </div>
        </div>
    </div>
</div>
 @* modal update hóa đơn *@

<div class="modal fade" tabindex="-1" id="pop_updatehoadon">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thông tin hóa đơn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <input id="btn_ma" style="display:none" class="form-control" type="text" />
                    </div>

                    <div class="col-md-4">
                        
                        <label for="btn_UserID">Người tạo</label>
                        <input id="btn_UserID" class="form-control" type="text" style="display:none" />
                        
                        @foreach (var nv in ListUseradmin)
                        {
                            if (nv.Id == Model.UserID)
                            {

                                <input type="type" id="btn_tennhanvien" class="form-control" value="@nv.FullName" readonly style="display:block" />
                            }
                        }
                       
                    </div>
                    <div class="col-md-4" style="display:none">
                        <label for="btn_MaVoucher">Mã Voucher</label>
                        <select id="btn_MaVoucher" class="form-select">
                            <option value="">Chọn</option>
                            @foreach (var item in lstVC)
                            {

                                <option value="@item.MaVoucher">@item.Ten</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="btn_NgayTaoDon">Ngày tạo</label>
                        <input id="btn_NgayTaoDon" class="form-control" type="datetime" />
                    </div>
                    <div class="col-md-4">
                        <label for="btn_Update">Ngày Update</label>
                        <input id="btn_Update" class="form-control" type="text" />
                    </div>
                    <div class="col-md-4">
                        <label for="btn_TenKhachHang">Tên khách hàng</label>
                        <input id="btn_TenKhachHang" class="form-control"/> 
                    </div>
                    <div class="col-md-4">
                        <label for="btn_SoDienThoai">Số điện thoại</label>
                        <input id="btn_SoDienThoai" class="form-control" type="text" />
                    </div>
                    <div class="col-md-4">
                        <label for="City">Tỉnh/Thành phố</label>
                        <select class="form-control" id="city" name="City">
                            <option value="" selected>Chọn tỉnh thành</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="District">Quận/Huyện</label>
                        <select class="form-control" id="district" name="District">
                            <option value="" selected>Chọn quận huyện</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="Ward">Phường/Xã</label>
                        <select class="form-control" id="ward" name="Ward">
                            <option value="" selected>Chọn phường xã</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="street">Địa chỉ cụ thể</label>
                        <input type="text" class="form-control" name="Street" id="street">
                    </div>
                    <div class="col-md-4">
                        <label for="btn_PhiShip">Phí ship</label>
                        <input id="btn_PhiShip" class="form-control money" type="text" />
                       
                    </div>
                    <div class="col-md-12 text-center">
                        <label for="clear"></label>
                        <button type="text" class="form-control w-50 d-grid gap-2 col-6 mx-auto" name="clear" id="clear">Chọn lại địa chỉ</button>
                    </div>
                    
                    <div class="col-md-10">
                        <label for="btn_ghichu">Ghi chú</label>
                        <textarea id="btn_ghichu" class="form-control" type="text" /></textarea>
                    </div>
                    <div class="col-md-4" style="display:none">
                        <label for="btn_TongGiaTriHangHoa">Tổng tiền</label>
                        <input id="btn_TongGiaTriHangHoa" class="form-control money" type="text" />
                    </div>
                    <div class="col-md-4" style="display:none">
                        <label for="btn_PhuongTTT">Phương thức thanh toán</label>
                        <select id="btn_PhuongTTT" class="form-select">
                            @foreach (var item in lstt)
                            {
                                <option value="@item.MaPhuongThuc">@item.TenPhuongThuc</option>
                            }
                        </select>
                    </div>
                    <div class="col-md-4" style="display:none">
                        <label for="btn_Status">Trạng thái</label>
                        <select id="btn_Status" class="form-select">
                            <option value="">Chọn</option>
                            <option value="1">Chờ xác nhận</option>
                            <option value="2">Xác nhận</option>
                            <option value="3">Chờ giao hàng</option>
                            <option value="4">Đang giao hàng</option>
                            <option value="5">Hoàn thành</option>
                            <option value="6">Hủy</option>
                        </select>
                    </div>
                    <div class="col-md-6" style="display:none">
                        <label for="btn_phanloai" style="display:none">PhanLoai</label>
                        <input id="btn_phanloai" class="form-control" type="number" />
                    </div>
                </div>
            </div>
           
            <div class="modal-footer">
                <button id="btn_close" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btn_save">Cập nhật</button>
            </div>
        </div>
    </div>
</div>

@* modal lịch sử hóa đơn   *@
<div class="modal fade" tabindex="-1" id="pop_lshd">
    <div class="modal-dialog  modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Lịch sử hóa đơn</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">STT</th>
                            <th scope="col">Người tạo</th>
                            <th scope="col">Ngày tạo</th>
                            <th scope="col">Chi tiết</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int a = 1;

                        }
                           
                        @foreach(var item in ListLSHD)
                        {
                            <tr>
                                <td>@a</td>
                                <td>
                                    @item.UserID
                                </td>
                                <td>@item.NgayTaoDon</td>
                                <td>
                                    @if (item.ChiTiet == "1")
                                    {
                                        <p>Đặt hàng</p>
                                    }
                                    @if (item.ChiTiet == "2")
                                    {
                                        <p>Xác nhận đơn hàng</p>
                                    }
                                    @if (item.ChiTiet == "3")
                                    {
                                        <p>Chờ giao hàng</p>
                                    }
                                    @if (item.ChiTiet == "4")
                                    {
                                        <p>Đang giao hàng</p>
                                    }
                                    @if (item.ChiTiet == "5")
                                    {
                                        <p>Hoàn thành</p>
                                    }
                                    @if (item.TrangThai == 6)
                                    {
                                        <p>Hủy đơn hàng</p> <br />
                                        <p>Ghi chú: @item.ChiTiet</p>
                                    }
                                    @if (item.TrangThai == 7)
                                    {
                                        <p>Chỉnh sửa hóa đơn</p> <br />
                                        <p>Ghi chú: @item.ChiTiet</p>
                                    }
                                </td>
                           </tr>
                            a++;
                        }
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div style="display:none">
    <input id="btn_TongGiaTriHangHoa_fake" />
    <input id="btn_ma_fake" />
    <input id="btn_UserID_fake" />
    <input id="btn_MaVoucher_fake" />
    <input type="datetime" id="btn_NgayTaoDon_fake" />
    <input type="datetime" id="btn_Update_fake" />
    <input id="btn_TenKhachHang_fake" />
    <input id="btn_SoDienThoai_fake" />
    <input id="btn_PhiShip_fake" />
    <input id="btn_PhuongTTT_fake" />
    <input id="btn_Status_fake" />
    <input id="btn_phanloai_fake" />
    <input id="city_fake" />
    <input id="district_fake" />
    <input id="ward_fake" />
    <input id="street_fake" />
    <input id="btn_ghichu_fake" />
    <input id="tongtiennew_fake" />
    <input id="stthoadon_fake" />
</div>
    @if (User.Identity.IsAuthenticated)
    {
        <input type="text" id="btn_UserIDlogin" value="@user.UserId" style="display:none" />
    <input class="form-control" type="text" id="btn_UserName" value="@user.UserName" style="display:none" />

    }
    else
    {
        <p>You are not logged in.</p>
    }
@section scripts {
    <script>
        // Định dạng số tiền
        function formatMoney(amount) {
            if (!isNaN(amount) && amount !== null && amount !== '') {
                return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
            } else {
                return amount;
            }
        }

        // Duyệt qua các ô chứa số tiền và định dạng
        $(document).ready(function () {
            $('.money').each(function () {
                var amountText = $(this).text().trim(); // Lấy số tiền từ văn bản, loại bỏ dấu phân cách nếu có
                var amountWithoutCommas = amountText.split(',')[0].replace(/,/g, ''); // Bỏ dấu phẩy và phần sau dấu phẩy
                var amount = parseFloat(amountWithoutCommas);
                if (!isNaN(amount)) {
                    $(this).text(formatMoney(amount)); // Định dạng và gán lại vào văn bản
                }
            });
        });
    </script>
}